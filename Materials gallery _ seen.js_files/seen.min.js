/** seen.js v0.2.5 | themadcreator.github.io/seen | (c) Bill Dwyer | @license: Apache 2.0 */
!function(){var t,n,e,r,i,s,o,a,u,h,l,c,p,f,d,m,y,g,v,x,_,w,M,P,S,b,C,A,z,E,T=function(t,n){return function(){return t.apply(n,arguments)}},q=[].slice,F=function(t,n){function e(){this.constructor=t}for(var r in n)R.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},R={}.hasOwnProperty;E={},"undefined"!=typeof window&&null!==window&&(window.seen=E),null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)&&(module.exports=E),y=1,E.Util={defaults:function(t,n,e){var r,i;for(r in n)null==t[r]&&(t[r]=n[r]);i=[];for(r in e)i.push(null==t[r]?t[r]=e[r]:void 0);return i},arraysEqual:function(t,n){var e,r,i,s;if(!t.length===n.length)return!1;for(e=i=0,r=t.length;r>i;e=++i)if(s=t[e],s!==n[e])return!1;return!0},uniqueId:function(t){return null==t&&(t=""),t+y++},element:function(t){return"string"==typeof t?document.getElementById(t):t}},E.Events={dispatch:function(){var t,n,e,r;for(n=new E.Events.Dispatcher,r=0,e=arguments.length;e>r;r++)t=arguments[r],n[t]=E.Events.Event();return n}},E.Events.Dispatcher=function(){function t(){this.on=T(this.on,this)}return t.prototype.on=function(t,n){var e,r;return e=t.indexOf("."),r="",e>0&&(r=t.substring(e+1),t=t.substring(0,e)),null!=this[t]&&this[t].on(r,n),this},t}(),E.Events.Event=function(){var t;return t=function(){var n,e,r,i;r=t.listenerMap,i=[];for(e in r)n=r[e],i.push(null!=n?n.apply(this,arguments):void 0);return i},t.listenerMap={},t.on=function(n,e){return delete t.listenerMap[n],null!=e?t.listenerMap[n]=e:void 0},t},t=new Array(16),m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],M=[0,4,8,12,1,5,9,13,2,6,10,14,3,7,11,15],E.Matrix=function(){function n(t){this.m=null!=t?t:null,null==this.m&&(this.m=m.slice()),this.baked=m}return n.prototype.copy=function(){return new E.Matrix(this.m.slice())},n.prototype.matrix=function(n){var e,r,i,s,o;for(e=t,i=s=0;4>s;i=++s)for(r=o=0;16>o;r=o+=4)e[r+i]=n[r]*this.m[i]+n[r+1]*this.m[4+i]+n[r+2]*this.m[8+i]+n[r+3]*this.m[12+i];return t=this.m,this.m=e,this},n.prototype.reset=function(){return this.m=this.baked.slice(),this},n.prototype.bake=function(t){return this.baked=(null!=t?t:this.m).slice(),this},n.prototype.multiply=function(t){return this.matrix(t.m)},n.prototype.transpose=function(){var n,e,r,i,s;for(n=t,e=i=0,r=M.length;r>i;e=++i)s=M[e],n[e]=this.m[s];return t=this.m,this.m=n,this},n.prototype.rotx=function(t){var n,e,r;return n=Math.cos(t),r=Math.sin(t),e=[1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1],this.matrix(e)},n.prototype.roty=function(t){var n,e,r;return n=Math.cos(t),r=Math.sin(t),e=[n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1],this.matrix(e)},n.prototype.rotz=function(t){var n,e,r;return n=Math.cos(t),r=Math.sin(t),e=[n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1],this.matrix(e)},n.prototype.translate=function(t,n,e){var r;return null==t&&(t=0),null==n&&(n=0),null==e&&(e=0),r=[1,0,0,t,0,1,0,n,0,0,1,e,0,0,0,1],this.matrix(r)},n.prototype.scale=function(t,n,e){var r;return null==t&&(t=1),null==n&&(n=t),null==e&&(e=n),r=[t,0,0,0,0,n,0,0,0,0,e,0,0,0,0,1],this.matrix(r)},n}(),E.M=function(t){return new E.Matrix(t)},E.Matrices={identity:function(){return E.M()},flipX:function(){return E.M().scale(-1,1,1)},flipY:function(){return E.M().scale(1,-1,1)},flipZ:function(){return E.M().scale(1,1,-1)}},E.Transformable=function(){function t(){var t,n,e,r,i;for(this.m=new E.Matrix,this.baked=m,i=["scale","translate","rotx","roty","rotz","matrix","reset","bake"],t=function(t){return function(n){return t[n]=function(){var t;return(t=this.m[n]).call.apply(t,[this.m].concat(q.call(arguments))),this}}}(this),r=0,n=i.length;n>r;r++)e=i[r],t(e)}return t.prototype.transform=function(t){return this.m.multiply(t),this},t}(),E.Point=function(){function t(t,n,e,r){this.x=null!=t?t:0,this.y=null!=n?n:0,this.z=null!=e?e:0,this.w=null!=r?r:1}return t.prototype.copy=function(){return new E.Point(this.x,this.y,this.z,this.w)},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.translate=function(t,n,e){return this.x+=t,this.y+=n,this.z+=e,this},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this},t.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},t.prototype.normalize=function(){var t;return t=this.magnitude(),0===t?this.set(E.Points.Z()):this.divide(t),this},t.prototype.perpendicular=function(){var t,n;return n=this.copy().cross(E.Points.Z()),t=n.magnitude(),0!==t?n.divide(t):this.copy().cross(E.Points.X()).normalize()},t.prototype.transform=function(t){var n;return n=g,n.x=this.x*t.m[0]+this.y*t.m[1]+this.z*t.m[2]+this.w*t.m[3],n.y=this.x*t.m[4]+this.y*t.m[5]+this.z*t.m[6]+this.w*t.m[7],n.z=this.x*t.m[8]+this.y*t.m[9]+this.z*t.m[10]+this.w*t.m[11],n.w=this.x*t.m[12]+this.y*t.m[13]+this.z*t.m[14]+this.w*t.m[15],this.set(n),this},t.prototype.magnitudeSquared=function(){return this.dot(this)},t.prototype.magnitude=function(){return Math.sqrt(this.magnitudeSquared())},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.cross=function(t){var n;return n=g,n.x=this.y*t.z-this.z*t.y,n.y=this.z*t.x-this.x*t.z,n.z=this.x*t.y-this.y*t.x,this.set(n),this},t}(),E.P=function(t,n,e,r){return new E.Point(t,n,e,r)},g=E.P(),E.Points={X:function(){return E.P(1,0,0)},Y:function(){return E.P(0,1,0)},Z:function(){return E.P(0,0,1)},ZERO:function(){return E.P(0,0,0)}},E.Quaternion=function(){function t(){this.q=E.P.apply(E,arguments)}return t.pixelsPerRadian=150,t.xyToTransform=function(t,n){var e,r;return e=E.Quaternion.pointAngle(E.Points.Y(),t/E.Quaternion.pixelsPerRadian),r=E.Quaternion.pointAngle(E.Points.X(),n/E.Quaternion.pixelsPerRadian),e.multiply(r).toMatrix()},t.axisAngle=function(t,n,e,r){var i,s;return i=Math.sin(r/2),s=Math.cos(r/2),new E.Quaternion(i*t,i*n,i*e,s)},t.pointAngle=function(t,n){var e,r;return e=Math.sin(n/2),r=Math.cos(n/2),new E.Quaternion(e*t.x,e*t.y,e*t.z,r)},t.prototype.multiply=function(t){var n,e;return n=E.P(),n.w=this.q.w*t.q.w-this.q.x*t.q.x-this.q.y*t.q.y-this.q.z*t.q.z,n.x=this.q.w*t.q.x+this.q.x*t.q.w+this.q.y*t.q.z-this.q.z*t.q.y,n.y=this.q.w*t.q.y+this.q.y*t.q.w+this.q.z*t.q.x-this.q.x*t.q.z,n.z=this.q.w*t.q.z+this.q.z*t.q.w+this.q.x*t.q.y-this.q.y*t.q.x,e=new E.Quaternion,e.q=n,e},t.prototype.toMatrix=function(){var t;return t=new Array(16),t[0]=1-2*(this.q.y*this.q.y+this.q.z*this.q.z),t[1]=2*(this.q.x*this.q.y-this.q.w*this.q.z),t[2]=2*(this.q.x*this.q.z+this.q.w*this.q.y),t[3]=0,t[4]=2*(this.q.x*this.q.y+this.q.w*this.q.z),t[5]=1-2*(this.q.x*this.q.x+this.q.z*this.q.z),t[6]=2*(this.q.y*this.q.z-this.q.w*this.q.x),t[7]=0,t[8]=2*(this.q.x*this.q.z-this.q.w*this.q.y),t[9]=2*(this.q.y*this.q.z+this.q.w*this.q.x),t[10]=1-2*(this.q.x*this.q.x+this.q.y*this.q.y),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,E.M(t)},t}(),E.Bounds=function(){function t(){this.maxZ=T(this.maxZ,this),this.maxY=T(this.maxY,this),this.maxX=T(this.maxX,this),this.minZ=T(this.minZ,this),this.minY=T(this.minY,this),this.minX=T(this.minX,this),this.depth=T(this.depth,this),this.height=T(this.height,this),this.width=T(this.width,this),this.min=null,this.max=null}return t.points=function(t){var n,e,r,i;for(n=new E.Bounds,r=0,e=t.length;e>r;r++)i=t[r],n.add(i);return n},t.xywh=function(t,n,e,r){return E.Boundses.xyzwhd(t,n,0,e,r,0)},t.xyzwhd=function(t,n,e,r,i,s){var o;return o=new E.Bounds,o.add(E.P(t,n,e)),o.add(E.P(t+r,n+i,e+s)),o},t.prototype.copy=function(){var t,n,e;return t=new E.Bounds,t.min=null!=(n=this.min)?n.copy():void 0,t.max=null!=(e=this.max)?e.copy():void 0,t},t.prototype.add=function(t){return null==this.min||null==this.max?(this.min=t.copy(),this.max=t.copy()):(this.min.x=Math.min(this.min.x,t.x),this.min.y=Math.min(this.min.y,t.y),this.min.z=Math.min(this.min.z,t.z),this.max.x=Math.max(this.max.x,t.x),this.max.y=Math.max(this.max.y,t.y),this.max.z=Math.max(this.max.z,t.z)),this},t.prototype.valid=function(){return null!=this.min&&null!=this.max},t.prototype.intersect=function(t){return this.valid()&&t.valid()?(this.min=E.P(Math.max(this.min.x,t.min.x),Math.max(this.min.y,t.min.y),Math.max(this.min.z,t.min.z)),this.max=E.P(Math.min(this.max.x,t.max.x),Math.min(this.max.y,t.max.y),Math.min(this.max.z,t.max.z)),(this.min.x>this.max.x||this.min.y>this.max.y||this.min.z>this.max.z)&&(this.min=null,this.max=null)):(this.min=null,this.max=null),this},t.prototype.pad=function(t,n,e){var r;return this.valid()&&(null==n&&(n=t),null==e&&(e=n),r=E.P(t,n,e),this.min.subtract(r),this.max.add(r)),this},t.prototype.reset=function(){return this.min=null,this.max=null,this},t.prototype.contains=function(t){return this.valid()?this.min.x>t.x||this.max.x<t.x?!1:this.min.y>t.y||this.max.y<t.y?!1:this.min.z>t.z||this.max.z<t.z?!1:!0:!1},t.prototype.center=function(){return E.P(this.minX()+this.width()/2,this.minY()+this.height()/2,this.minZ()+this.depth()/2)},t.prototype.width=function(){return this.maxX()-this.minX()},t.prototype.height=function(){return this.maxY()-this.minY()},t.prototype.depth=function(){return this.maxZ()-this.minZ()},t.prototype.minX=function(){var t,n;return null!=(t=null!=(n=this.min)?n.x:void 0)?t:0},t.prototype.minY=function(){var t,n;return null!=(t=null!=(n=this.min)?n.y:void 0)?t:0},t.prototype.minZ=function(){var t,n;return null!=(t=null!=(n=this.min)?n.z:void 0)?t:0},t.prototype.maxX=function(){var t,n;return null!=(t=null!=(n=this.max)?n.x:void 0)?t:0},t.prototype.maxY=function(){var t,n;return null!=(t=null!=(n=this.max)?n.y:void 0)?t:0},t.prototype.maxZ=function(){var t,n;return null!=(t=null!=(n=this.max)?n.z:void 0)?t:0},t}(),E.Color=function(){function t(t,n,e,r){this.r=null!=t?t:0,this.g=null!=n?n:0,this.b=null!=e?e:0,this.a=null!=r?r:255}return t.prototype.copy=function(){return new E.Color(this.r,this.g,this.b,this.a)},t.prototype.scale=function(t){return this.r*=t,this.g*=t,this.b*=t,this},t.prototype.offset=function(t){return this.r+=t,this.g+=t,this.b+=t,this},t.prototype.clamp=function(t,n){return null==t&&(t=0),null==n&&(n=255),this.r=Math.min(n,Math.max(t,this.r)),this.g=Math.min(n,Math.max(t,this.g)),this.b=Math.min(n,Math.max(t,this.b)),this},t.prototype.minChannels=function(t){return this.r=Math.min(t.r,this.r),this.g=Math.min(t.g,this.g),this.b=Math.min(t.b,this.b),this},t.prototype.addChannels=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},t.prototype.multiplyChannels=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},t.prototype.hex=function(){var t;for(t=(this.r<<16|this.g<<8|this.b).toString(16);t.length<6;)t="0"+t;return"#"+t},t.prototype.style=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},t}(),E.Colors={CSS_RGBA_STRING_REGEX:/rgb(a)?\(([0-9.]+),([0-9.]+),*([0-9.]+)(,([0-9.]+))?\)/,parse:function(t){var n,e;return"#"===t.charAt(0)&&7===t.length?E.Colors.hex(t):0===t.indexOf("rgb")?(e=E.Colors.CSS_RGBA_STRING_REGEX.exec(t),null==e?E.Colors.black():(n=null!=e[6]?Math.round(255*parseFloat(e[6])):void 0,new E.Color(parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4]),n))):E.Colors.black()},rgb:function(t,n,e,r){return null==r&&(r=255),new E.Color(t,n,e,r)},hex:function(t){return"#"===t.charAt(0)&&(t=t.substring(1)),new E.Color(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16))},hsl:function(t,n,e,r){var i,s,o,a,u,h;return null==r&&(r=1),h=s=i=0,0===n?h=s=i=e:(o=function(t,n,e){return 0>e?e+=1:e>1&&(e-=1),1/6>e?t+6*(n-t)*e:.5>e?n:2/3>e?t+(n-t)*(2/3-e)*6:t},u=.5>e?e*(1+n):e+n-e*n,a=2*e-u,h=o(a,u,t+1/3),s=o(a,u,t),i=o(a,u,t-1/3)),new E.Color(255*h,255*s,255*i,255*r)},randomSurfaces:function(t,n,e){var r,i,s,o,a;for(null==n&&(n=.5),null==e&&(e=.4),s=t.surfaces,o=[],i=0,r=s.length;r>i;i++)a=s[i],o.push(a.fill(E.Colors.hsl(Math.random(),n,e)));return o},randomSurfaces2:function(t,n,e,r){var i,s,o,a,u,h;for(null==n&&(n=.03),null==e&&(e=.5),null==r&&(r=.4),i=Math.random(),a=t.surfaces,u=[],o=0,s=a.length;s>o;o++){for(h=a[o],i+=(Math.random()-.5)*n;0>i;)i+=1;for(;i>1;)i-=1;u.push(h.fill(E.Colors.hsl(i,.5,.4)))}return u},randomShape:function(t,n,e){return null==n&&(n=.5),null==e&&(e=.4),t.fill(new E.Material(E.Colors.hsl(Math.random(),n,e)))},black:function(){return this.hex("#000000")},white:function(){return this.hex("#FFFFFF")},gray:function(){return this.hex("#888888")}},E.C=function(t,n,e,r){return new E.Color(t,n,e,r)},E.Material=function(){function t(t,n){this.color=t,null==n&&(n={}),E.Util.defaults(this,n,this.defaults)}return t.create=function(t){return t instanceof E.Material?t:t instanceof E.Color?new E.Material(t):"string"==typeof t?new E.Material(E.Colors.parse(t)):new E.Material},t.prototype.defaults={color:E.Colors.gray(),metallic:!1,specularColor:E.Colors.white(),specularExponent:15,shader:null},t.prototype.render=function(t,n,e){var r,i,s;return s=null!=(i=this.shader)?i:n,r=s.shade(t,e,this),r.a=this.color.a,r},t}(),E.Light=function(t){function n(t,e){this.type=t,n.__super__.constructor.apply(this,arguments),E.Util.defaults(this,e,this.defaults),this.id=E.Util.uniqueId("l")}return F(n,t),n.prototype.defaults={point:E.P(),color:E.Colors.white(),intensity:.01,normal:E.P(1,-1,-1).normalize(),enabled:!0},n.prototype.render=function(){return this.colorIntensity=this.color.copy().scale(this.intensity)},n}(E.Transformable),E.Lights={point:function(t){return new E.Light("point",t)},directional:function(t){return new E.Light("directional",t)},ambient:function(t){return new E.Light("ambient",t)}},a=E.Points.Z(),E.ShaderUtils={applyDiffuse:function(t,n,e,r){var i;return i=e.dot(r),i>0?t.addChannels(n.colorIntensity.copy().scale(i)):void 0},applyDiffuseAndSpecular:function(t,n,e,r,i){var s,o,u,h;return s=e.dot(r),s>0?(t.addChannels(n.colorIntensity.copy().scale(s)),o=r.copy().multiply(2*s).subtract(e),h=Math.pow(.5+o.dot(a),i.specularExponent),u=i.specularColor.copy().scale(h*n.intensity/255),t.addChannels(u)):void 0},applyAmbient:function(t,n){return t.addChannels(n.colorIntensity)}},E.Shader=function(){function t(){}return t.prototype.shade=function(){},t}(),x=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype.shade=function(t,n,e){var r,i,s,o,a;for(r=new E.Color,a=0,i=t.length;i>a;a++)switch(s=t[a],s.type){case"point":o=s.point.copy().subtract(n.barycenter).normalize(),E.ShaderUtils.applyDiffuseAndSpecular(r,s,o,n.normal,e);break;case"directional":E.ShaderUtils.applyDiffuseAndSpecular(r,s,s.normal,n.normal,e);break;case"ambient":E.ShaderUtils.applyAmbient(r,s)}return r.multiplyChannels(e.color),e.metallic&&r.minChannels(e.specularColor),r.clamp(0,255),r},n}(E.Shader),s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype.shade=function(t,n,e){var r,i,s,o,a;for(r=new E.Color,a=0,i=t.length;i>a;a++)switch(s=t[a],s.type){case"point":o=s.point.copy().subtract(n.barycenter).normalize(),E.ShaderUtils.applyDiffuse(r,s,o,n.normal,e);break;case"directional":E.ShaderUtils.applyDiffuse(r,s,s.normal,n.normal,e);break;case"ambient":E.ShaderUtils.applyAmbient(r,s)}return r.multiplyChannels(e.color).clamp(0,255),r},n}(E.Shader),n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype.shade=function(t,n,e){var r,i,s,o;for(r=new E.Color,o=0,i=t.length;i>o;o++)switch(s=t[o],s.type){case"ambient":E.ShaderUtils.applyAmbient(r,s)}return r.multiplyChannels(e.color).clamp(0,255),r},n}(E.Shader),h=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype.shade=function(t,n,e){return e.color},n}(E.Shader),E.Shaders={phong:function(){return new x},diffuse:function(){return new s},ambient:function(){return new n},flat:function(){return new h}},E.Affine={ORTHONORMAL_BASIS:function(){return[E.P(0,0,0),E.P(20,0,0),E.P(0,20,0)]},INITIAL_STATE_MATRIX:[[20,0,1,0,0,0],[0,20,1,0,0,0],[0,0,1,0,0,0],[0,0,0,20,0,1],[0,0,0,0,20,1],[0,0,0,0,0,1]],solveForAffineTransform:function(t){var n,e,r,i,s,o,a,u,h,l,c;for(n=E.Affine.INITIAL_STATE_MATRIX,e=[t[1].x,t[2].x,t[0].x,t[1].y,t[2].y,t[0].y],c=new Array(6),s=n.length,r=o=a=s-1;o>=0;r=o+=-1){for(c[r]=e[r],i=l=u=r+1,h=s;h>=u?h>l:l>h;i=h>=u?++l:--l)c[r]-=n[r][i]*c[i];c[r]/=n[r][r]}return c}},E.RenderContext=function(){function t(){this.render=T(this.render,this),this.layers=[]}return t.prototype.render=function(){var t,n,e,r;for(this.reset(),r=this.layers,e=0,n=r.length;n>e;e++)t=r[e],t.context.reset(),t.layer.render(t.context),t.context.cleanup();return this.cleanup(),this},t.prototype.animate=function(){return new E.RenderAnimator(this)},t.prototype.layer=function(t){return this.layers.push({layer:t,context:this}),this},t.prototype.sceneLayer=function(t){return this.layer(new E.SceneLayer(t)),this},t.prototype.reset=function(){},t.prototype.cleanup=function(){},t}(),E.RenderLayerContext=function(){function t(){}return t.prototype.path=function(){},t.prototype.rect=function(){},t.prototype.circle=function(){},t.prototype.text=function(){},t.prototype.reset=function(){},t.prototype.cleanup=function(){},t}(),E.Context=function(t,n){var e,r,i;return null==n&&(n=null),i=null!=(r=E.Util.element(t))?r.tagName.toUpperCase():void 0,e=function(){switch(i){case"SVG":case"G":return new E.SvgRenderContext(t);case"CANVAS":return new E.CanvasRenderContext(t)}}(),null!=e&&null!=n&&e.sceneLayer(n),e},E.Painter=function(){function t(){}return t.prototype.paint=function(){},t}(),E.PathPainter=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype.paint=function(t,n){var e,r,i;return e=n.path().path(t.projected.points),null!=t.fill&&e.fill({fill:null==t.fill?"none":t.fill.hex(),"fill-opacity":null==(null!=(r=t.fill)?r.a:void 0)?1:t.fill.a/255}),null!=t.stroke?e.draw({fill:"none",stroke:null==t.stroke?"none":t.stroke.hex(),"stroke-width":null!=(i=t.surface["stroke-width"])?i:1}):void 0},n}(E.Painter),E.TextPainter=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype.paint=function(t,n){var e,r,i;return r={fill:null==t.fill?"none":t.fill.hex(),font:t.surface.font,"text-anchor":null!=(e=t.surface.anchor)?e:"middle"},i=E.Affine.solveForAffineTransform(t.projected.points),n.text().fillText(i,t.surface.text,r)},n}(E.Painter),E.Painters={path:new E.PathPainter,text:new E.TextPainter},i=E.Points.Z(),E.RenderModel=function(){function t(t,n,e,r){this.surface=t,this.transform=n,this.projection=e,this.viewport=r,this.points=this.surface.points,this.transformed=this._initRenderData(),this.projected=this._initRenderData(),this._update()}return t.prototype.update=function(t,n,e){return!this.surface.dirty&&E.Util.arraysEqual(t.m,this.transform.m)&&E.Util.arraysEqual(n.m,this.projection.m)&&E.Util.arraysEqual(e.m,this.viewport.m)?void 0:(this.transform=t,this.projection=n,this.viewport=e,this._update())},t.prototype._update=function(){var t;return this._math(this.transformed,this.points,this.transform,!1),t=this.transformed.points.map(function(t){return function(n){return n.copy().transform(t.projection)}}(this)),this.inFrustrum=this._checkFrustrum(t),this._math(this.projected,t,this.viewport,!0),this.surface.dirty=!1},t.prototype._checkFrustrum=function(t){var n,e,r;for(e=0,n=t.length;n>e;e++)if(r=t[e],r.z<=-2)return!1;return!0},t.prototype._initRenderData=function(){var t;return{points:function(){var n,e,r,i;for(r=this.points,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t.copy());return i}.call(this),bounds:new E.Bounds,barycenter:E.P(),normal:E.P(),v0:E.P(),v1:E.P()}},t.prototype._math=function(t,n,e,r){var s,o,a,u,h,l,c,p,f,d,m;for(null==r&&(r=!1),o=l=0,a=n.length;a>l;o=++l)c=n[o],d=t.points[o],d.set(c).transform(e),r&&d.divide(d.w);for(t.barycenter.multiply(0),p=t.points,m=0,u=p.length;u>m;m++)c=p[m],t.barycenter.add(c);for(t.barycenter.divide(t.points.length),t.bounds.reset(),f=t.points,s=0,h=f.length;h>s;s++)c=f[s],t.bounds.add(c);return t.points.length<2?(t.v0.set(i),t.v1.set(i),t.normal.set(i)):(t.v0.set(t.points[1]).subtract(t.points[0]),t.v1.set(t.points[n.length-1]).subtract(t.points[0]),t.normal.set(t.v0).cross(t.v1).normalize())},t}(),E.LightRenderModel=function(){function t(t,n){var e;this.light=t,this.colorIntensity=this.light.color.copy().scale(this.light.intensity),this.type=this.light.type,this.intensity=this.light.intensity,this.point=this.light.point.copy().transform(n),e=E.Points.ZERO().transform(n),this.normal=this.light.normal.copy().transform(n).subtract(e).normalize()}return t}(),E.RenderLayer=function(){function t(){this.render=T(this.render,this)}return t.prototype.render=function(){},t}(),E.SceneLayer=function(t){function n(t){this.scene=t,this.render=T(this.render,this)}return F(n,t),n.prototype.render=function(t){var n,e,r,i,s;for(r=this.scene.render(),s=[],e=0,n=r.length;n>e;e++)i=r[e],s.push(i.surface.painter.paint(i,t));return s},n}(E.RenderLayer),E.FillLayer=function(t){function n(t,n,e){this.width=null!=t?t:500,this.height=null!=n?n:500,this.fill=null!=e?e:"#EEE",this.render=T(this.render,this)}return F(n,t),n.prototype.render=function(t){return t.rect().rect(this.width,this.height).fill({fill:this.fill})},n}(E.RenderLayer),P=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},E.SvgStyler=function(){function t(t){this.elementFactory=t}return t.prototype._attributes={},t.prototype._svgTag="g",t.prototype.clear=function(){return this._attributes={},this},t.prototype.fill=function(t){return null==t&&(t={}),this._paint(t),this},t.prototype.draw=function(t){return null==t&&(t={}),this._paint(t),this},t.prototype._paint=function(t){var n,e,r,i,s;n=this.elementFactory(this._svgTag),i="";for(e in t)s=t[e],i+=e+":"+s+";";n.setAttribute("style",i),r=this._attributes;for(e in r)s=r[e],n.setAttribute(e,s);return n},t}(),E.SvgPathPainter=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype._svgTag="path",n.prototype.path=function(t){return this._attributes.d="M"+t.map(function(t){return t.x+" "+t.y}).join("L"),this},n}(E.SvgStyler),E.SvgTextPainter=function(){function t(t){this.elementFactory=t}return t.prototype._svgTag="text",t.prototype.fillText=function(t,n,e){var r,i,s,o;null==e&&(e={}),r=this.elementFactory(this._svgTag),r.setAttribute("transform","matrix("+t[0]+" "+t[3]+" "+-t[1]+" "+-t[4]+" "+t[2]+" "+t[5]+")"),s="";for(i in e)o=e[i],null!=o&&(s+=i+":"+o+";");return r.setAttribute("style",s),r.textContent=n},t}(),E.SvgRectPainter=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype._svgTag="rect",n.prototype.rect=function(t,n){return this._attributes.width=t,this._attributes.height=n,this},n}(E.SvgStyler),E.SvgCirclePainter=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype._svgTag="circle",n.prototype.circle=function(t,n){return this._attributes.cx=t.x,this._attributes.cy=t.y,this._attributes.r=n,this},n}(E.SvgStyler),E.SvgLayerRenderContext=function(t){function n(t){this.group=t,this._elementFactory=T(this._elementFactory,this),this.pathPainter=new E.SvgPathPainter(this._elementFactory),this.textPainter=new E.SvgTextPainter(this._elementFactory),this.circlePainter=new E.SvgCirclePainter(this._elementFactory),this.rectPainter=new E.SvgRectPainter(this._elementFactory),this._i=0}return F(n,t),n.prototype.path=function(){return this.pathPainter.clear()},n.prototype.rect=function(){return this.rectPainter.clear()},n.prototype.circle=function(){return this.circlePainter.clear()},n.prototype.text=function(){return this.textPainter},n.prototype.reset=function(){return this._i=0},n.prototype.cleanup=function(){var t,n;for(t=this.group.childNodes,n=[];this._i<t.length;)t[this._i].setAttribute("style","display: none;"),n.push(this._i++);return n},n.prototype._elementFactory=function(t){var n,e,r;return n=this.group.childNodes,this._i>=n.length?(r=P(t),this.group.appendChild(r),this._i++,r):(e=n[this._i],e.tagName===t?(this._i++,e):(r=P(t),this.group.replaceChild(r,e),this._i++,r))},n}(E.RenderLayerContext),E.SvgRenderContext=function(t){function n(t){this.svg=t,n.__super__.constructor.call(this),this.svg=E.Util.element(this.svg)}return F(n,t),n.prototype.layer=function(t){var n;return this.svg.appendChild(n=P("g")),this.layers.push({layer:t,context:new E.SvgLayerRenderContext(n)}),this},n}(E.RenderContext),E.SvgContext=function(t,n){var e;return e=new E.SvgRenderContext(t),null!=n&&e.sceneLayer(n),e},E.CanvasStyler=function(){function t(t){this.ctx=t}return t.prototype.draw=function(t){return null==t&&(t={}),null!=t.stroke&&(this.ctx.strokeStyle=t.stroke),null!=t["stroke-width"]&&(this.ctx.lineWidth=t["stroke-width"]),null!=t["text-anchor"]&&(this.ctx.textAlign=t["text-anchor"]),this.ctx.stroke(),this},t.prototype.fill=function(t){return null==t&&(t={}),null!=t.fill&&(this.ctx.fillStyle=t.fill),null!=t["text-anchor"]&&(this.ctx.textAlign=t["text-anchor"]),t["fill-opacity"]&&(this.ctx.globalAlpha=t["fill-opacity"]),this.ctx.fill(),this},t}(),E.CanvasPathPainter=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype.path=function(t){var n,e,r,i;for(this.ctx.beginPath(),n=r=0,e=t.length;e>r;n=++r)i=t[n],0===n?this.ctx.moveTo(i.x,i.y):this.ctx.lineTo(i.x,i.y);return this.ctx.closePath(),this},n}(E.CanvasStyler),E.CanvasRectPainter=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype.rect=function(t,n){return this.ctx.rect(0,0,t,n),this},n}(E.CanvasStyler),E.CanvasCirclePainter=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype.circle=function(t,n){return this.ctx.beginPath(),this.ctx.arc(t.x,t.y,n,0,2*Math.PI,!0),this},n}(E.CanvasStyler),E.CanvasTextPainter=function(){function t(t){this.ctx=t}return t.prototype.fillText=function(t,n,e){return null==e&&(e={}),this.ctx.save(),this.ctx.setTransform(t[0],t[3],-t[1],-t[4],t[2],t[5]),null!=e.font&&(this.ctx.font=e.font),null!=e.fill&&(this.ctx.fillStyle=e.fill),null!=e["text-anchor"]&&(this.ctx.textAlign=this._cssToCanvasAnchor(e["text-anchor"])),this.ctx.fillText(n,0,0),this.ctx.restore(),this},t.prototype._cssToCanvasAnchor=function(t){return"middle"===t?"center":t},t}(),E.CanvasLayerRenderContext=function(t){function n(t){this.ctx=t,this.pathPainter=new E.CanvasPathPainter(this.ctx),this.ciclePainter=new E.CanvasCirclePainter(this.ctx),this.textPainter=new E.CanvasTextPainter(this.ctx),this.rectPainter=new E.CanvasRectPainter(this.ctx)}return F(n,t),n.prototype.path=function(){return this.pathPainter},n.prototype.rect=function(){return this.rectPainter},n.prototype.circle=function(){return this.ciclePainter},n.prototype.text=function(){return this.textPainter},n}(E.RenderLayerContext),E.CanvasRenderContext=function(t){function n(t){this.el=t,n.__super__.constructor.call(this),this.el=E.Util.element(this.el),this.ctx=this.el.getContext("2d")}return F(n,t),n.prototype.layer=function(t){return this.layers.push({layer:t,context:new E.CanvasLayerRenderContext(this.ctx)}),this},n.prototype.reset=function(){return this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.el.width,this.el.height)},n}(E.RenderContext),E.CanvasContext=function(t,n){var e;return e=new E.CanvasRenderContext(t),null!=n&&e.sceneLayer(n),e},E.WindowEvents=function(){var t;return t=E.Events.dispatch("mouseMove","mouseDown","mouseUp","touchStart","touchMove","touchEnd","touchCancel"),"undefined"!=typeof window&&null!==window&&(window.addEventListener("mouseup",t.mouseUp,!0),window.addEventListener("mousedown",t.mouseDown,!0),window.addEventListener("mousemove",t.mouseMove,!0),window.addEventListener("touchstart",t.touchStart,!0),window.addEventListener("touchmove",t.touchMove,!0),window.addEventListener("touchend",t.touchEnd,!0),window.addEventListener("touchcancel",t.touchCancel,!0)),{on:t.on}}(),E.MouseEvents=function(){function t(t,n){this.el=t,this._onMouseWheel=T(this._onMouseWheel,this),this._onMouseUp=T(this._onMouseUp,this),this._onMouseDown=T(this._onMouseDown,this),this._onMouseMove=T(this._onMouseMove,this),E.Util.defaults(this,n,this.defaults),this.el=E.Util.element(this.el),this._uid=E.Util.uniqueId("mouser-"),this.dispatch=E.Events.dispatch("dragStart","drag","dragEnd","mouseMove","mouseDown","mouseUp","mouseWheel"),this.on=this.dispatch.on,this._mouseDown=!1,this.attach()}return t.prototype.attach=function(){return this.el.addEventListener("touchstart",this._onMouseDown),this.el.addEventListener("mousedown",this._onMouseDown),this.el.addEventListener("mousewheel",this._onMouseWheel)},t.prototype.detach=function(){return this.el.removeEventListener("touchstart",this._onMouseDown),this.el.removeEventListener("mousedown",this._onMouseDown),this.el.removeEventListener("mousewheel",this._onMouseWheel)},t.prototype._onMouseMove=function(t){return this.dispatch.mouseMove(t),t.preventDefault(),t.stopPropagation(),this._mouseDown?this.dispatch.drag(t):void 0},t.prototype._onMouseDown=function(t){return this._mouseDown=!0,E.WindowEvents.on("mouseUp."+this._uid,this._onMouseUp),E.WindowEvents.on("mouseMove."+this._uid,this._onMouseMove),E.WindowEvents.on("touchEnd."+this._uid,this._onMouseUp),E.WindowEvents.on("touchCancel."+this._uid,this._onMouseUp),E.WindowEvents.on("touchMove."+this._uid,this._onMouseMove),this.dispatch.mouseDown(t),this.dispatch.dragStart(t)},t.prototype._onMouseUp=function(t){return this._mouseDown=!1,E.WindowEvents.on("mouseUp."+this._uid,null),E.WindowEvents.on("mouseMove."+this._uid,null),E.WindowEvents.on("touchEnd."+this._uid,null),E.WindowEvents.on("touchCancel."+this._uid,null),E.WindowEvents.on("touchMove."+this._uid,null),this.dispatch.mouseUp(t),this.dispatch.dragEnd(t)},t.prototype._onMouseWheel=function(t){return this.dispatch.mouseWheel(t)},t}(),E.InertialMouse=function(){function t(){this.reset()}return t.inertiaExtinction=.1,t.smoothingTimeout=300,t.inertiaMsecDelay=30,t.prototype.get=function(){var t;return t=1e3/E.InertialMouse.inertiaMsecDelay,[this.x*t,this.y*t]},t.prototype.reset=function(){return this.xy=[0,0],this},t.prototype.update=function(t){var n,e;return null!=this.lastUpdate?(n=(new Date).getTime()-this.lastUpdate.getTime(),t=t.map(function(t){return t/Math.max(n,1)}),e=Math.min(1,n/E.InertialMouse.smoothingTimeout),this.x=e*t[0]+(1-e)*this.x,this.y=e*t[1]+(1-e)*this.y):(this.x=t[0],this.y=t[1]),this.lastUpdate=new Date,this},t.prototype.damp=function(){return this.x*=1-E.InertialMouse.inertiaExtinction,this.y*=1-E.InertialMouse.inertiaExtinction,this},t}(),E.Drag=function(){function t(t,n){var e;this.el=t,this._stopInertia=T(this._stopInertia,this),this._startInertia=T(this._startInertia,this),this._onInertia=T(this._onInertia,this),this._onDrag=T(this._onDrag,this),this._onDragEnd=T(this._onDragEnd,this),this._onDragStart=T(this._onDragStart,this),this._getPageCoords=T(this._getPageCoords,this),E.Util.defaults(this,n,this.defaults),this.el=E.Util.element(this.el),this._uid=E.Util.uniqueId("dragger-"),this._inertiaRunning=!1,this._dragState={dragging:!1,origin:null,last:null,inertia:new E.InertialMouse},this.dispatch=E.Events.dispatch("drag","dragStart","dragEnd","dragEndInertia"),this.on=this.dispatch.on,e=new E.MouseEvents(this.el),e.on("dragStart."+this._uid,this._onDragStart),e.on("dragEnd."+this._uid,this._onDragEnd),e.on("drag."+this._uid,this._onDrag)}return t.prototype.defaults={inertia:!1},t.prototype._getPageCoords=function(t){var n,e;return(null!=(n=t.touches)?n.length:void 0)>0?[t.touches[0].pageX,t.touches[0].pageY]:(null!=(e=t.changedTouches)?e.length:void 0)>0?[t.changedTouches[0].pageX,t.changedTouches[0].pageY]:[t.pageX,t.pageY]},t.prototype._onDragStart=function(t){return this._stopInertia(),this._dragState.dragging=!0,this._dragState.origin=this._getPageCoords(t),this._dragState.last=this._getPageCoords(t),this.dispatch.dragStart(t)
},t.prototype._onDragEnd=function(t){var n,e;return this._dragState.dragging=!1,this.inertia&&(e=this._getPageCoords(t),n={offset:[e[0]-this._dragState.origin[0],e[1]-this._dragState.origin[1]],offsetRelative:[e[0]-this._dragState.last[0],e[1]-this._dragState.last[1]]},this._dragState.inertia.update(n.offsetRelative),this._startInertia()),this.dispatch.dragEnd(t)},t.prototype._onDrag=function(t){var n,e;return e=this._getPageCoords(t),n={offset:[e[0]-this._dragState.origin[0],e[1]-this._dragState.origin[1]],offsetRelative:[e[0]-this._dragState.last[0],e[1]-this._dragState.last[1]]},this.dispatch.drag(n),this.inertia&&this._dragState.inertia.update(n.offsetRelative),this._dragState.last=e},t.prototype._onInertia=function(){var t;if(this._inertiaRunning)return t=this._dragState.inertia.damp().get(),Math.abs(t[0])<1&&Math.abs(t[1])<1?(this._stopInertia(),void this.dispatch.dragEndInertia()):(this.dispatch.drag({offset:[this._dragState.last[0]-this._dragState.origin[0],this._dragState.last[0]-this._dragState.origin[1]],offsetRelative:t}),this._dragState.last=[this._dragState.last[0]+t[0],this._dragState.last[1]+t[1]],this._startInertia())},t.prototype._startInertia=function(){return this._inertiaRunning=!0,setTimeout(this._onInertia,E.InertialMouse.inertiaMsecDelay)},t.prototype._stopInertia=function(){return this._dragState.inertia.reset(),this._inertiaRunning=!1},t}(),E.Zoom=function(){function t(t,n){var e;this.el=t,this._onMouseWheel=T(this._onMouseWheel,this),E.Util.defaults(this,n,this.defaults),this.el=E.Util.element(this.el),this._uid=E.Util.uniqueId("zoomer-"),this.dispatch=E.Events.dispatch("zoom"),this.on=this.dispatch.on,e=new E.MouseEvents(this.el),e.on("mouseWheel."+this._uid,this._onMouseWheel)}return t.prototype.defaults={speed:.25},t.prototype._onMouseWheel=function(t){var n,e,r;return t.preventDefault(),n=t.wheelDelta/Math.abs(t.wheelDelta),r=Math.abs(t.wheelDelta)/120*this.speed,e=Math.pow(2,n*r),this.dispatch.zoom({zoom:e})},t}(),E.Surface=function(){function t(t,n){this.points=t,this.painter=null!=n?n:E.Painters.path,this.id="s"+E.Util.uniqueId()}return t.prototype.cullBackfaces=!0,t.prototype.fillMaterial=new E.Material(E.C.gray),t.prototype.strokeMaterial=null,t.prototype.fill=function(t){return this.fillMaterial=E.Material.create(t),this},t.prototype.stroke=function(t){return this.strokeMaterial=E.Material.create(t),this},t}(),E.Shape=function(t){function n(t,e){this.type=t,this.surfaces=e,n.__super__.constructor.call(this)}return F(n,t),n.prototype.eachSurface=function(t){return this.surfaces.forEach(t),this},n.prototype.fill=function(t){return this.eachSurface(function(n){return n.fill(t)}),this},n.prototype.stroke=function(t){return this.eachSurface(function(n){return n.stroke(t)}),this},n}(E.Transformable),E.Model=function(t){function n(){n.__super__.constructor.call(this),this.children=[],this.lights=[]}return F(n,t),n.prototype.add=function(){var t,n,e,r;for(n=1<=arguments.length?q.call(arguments,0):[],r=0,e=n.length;e>r;r++)t=n[r],t instanceof E.Shape||t instanceof E.Model?this.children.push(t):t instanceof E.Light&&this.lights.push(t);return this},n.prototype.remove=function(){var t,n,e,r,i,s;for(n=1<=arguments.length?q.call(arguments,0):[],s=[],i=0,r=n.length;r>i;i++){for(t=n[i];(e=this.children.indexOf(t))>=0;)this.children.splice(e,1);s.push(function(){var n;for(n=[];(e=this.lights.indexOf(t))>=0;)n.push(this.lights.splice(e,1));return n}.call(this))}return s},n.prototype.append=function(){var t;return t=new E.Model,this.add(t),t},n.prototype.eachShape=function(t){var n,e,r,i,s;for(i=this.children,s=[],r=0,e=i.length;e>r;r++)n=i[r],n instanceof E.Shape&&t.call(this,n),s.push(n instanceof E.Model?n.eachShape(t):void 0);return s},n.prototype.eachRenderable=function(t,n){return this._eachRenderable(t,n,[],this.m)},n.prototype._eachRenderable=function(t,n,e,r){var i,s,o,a,u,h,l,c,p;for(this.lights.length>0&&(e=e.slice()),h=this.lights,u=0,s=h.length;s>u;u++)a=h[u],a.enabled&&e.push(t.call(this,a,a.m.copy().multiply(r)));for(l=this.children,c=[],p=0,o=l.length;o>p;p++)i=l[p],i instanceof E.Shape&&n.call(this,i,e,i.m.copy().multiply(r)),c.push(i instanceof E.Model?i._eachRenderable(t,n,e,i.m.copy().multiply(r)):void 0);return c},n}(E.Transformable),E.Models={"default":function(){var t;return t=new E.Model,t.add(E.Lights.directional({normal:E.P(-1,1,1).normalize(),color:E.Colors.hsl(.1,.3,.7),intensity:.004})),t.add(E.Lights.directional({normal:E.P(1,1,-1).normalize(),intensity:.003})),t.add(E.Lights.ambient({intensity:.0015})),t}},"undefined"!=typeof window&&null!==window&&(z=null!=(b=null!=(C=null!=(A=window.requestAnimationFrame)?A:window.mozRequestAnimationFrame)?C:window.webkitRequestAnimationFrame)?b:window.msRequestAnimationFrame),r=30,E.Animator=function(){function t(){this.frame=T(this.frame,this),this.dispatch=E.Events.dispatch("beforeFrame","afterFrame","frame"),this.on=this.dispatch.on,this.timestamp=0,this._running=!1,this.frameDelay=null}return t.prototype.start=function(){return this._running=!0,null!=this.frameDelay&&(this._lastTime=(new Date).valueOf(),this._delayCompensation=0),this.animateFrame(),this},t.prototype.stop=function(){return this._running=!1,this},t.prototype.animateFrame=function(){var t,n,e;return null!=z&&null==this.frameDelay?z(this.frame):(t=(new Date).valueOf()-this._lastTime,this._lastTime+=t,this._delayCompensation+=t,n=null!=(e=this.frameDelay)?e:r,setTimeout(this.frame,n-this._delayCompensation)),this},t.prototype.frame=function(t){var n,e;if(this._running)return this._timestamp=null!=t?t:this._timestamp+(null!=(e=this._msecDelay)?e:r),n=null!=this._lastTimestamp?this._timestamp-this._lastTimestamp:this._timestamp,this.dispatch.beforeFrame(this._timestamp,n),this.dispatch.frame(this._timestamp,n),this.dispatch.afterFrame(this._timestamp,n),this._lastTimestamp=this._timestamp,this.animateFrame(),this},t.prototype.onBefore=function(t){return this.on("beforeFrame."+E.Util.uniqueId("animator-"),t),this},t.prototype.onAfter=function(t){return this.on("afterFrame."+E.Util.uniqueId("animator-"),t),this},t.prototype.onFrame=function(t){return this.on("frame."+E.Util.uniqueId("animator-"),t),this},t}(),E.RenderAnimator=function(t){function n(t){n.__super__.constructor.apply(this,arguments),this.onFrame(t.render)}return F(n,t),n}(E.Animator),E.Transition=function(){function t(t){null==t&&(t={}),E.Util.defaults(this,t,this.defaults)}return t.prototype.defaults={duration:100},t.prototype.update=function(t){return null==this.t&&(this.firstFrame(),this.startT=t),this.t=t,this.tFrac=(this.t-this.startT)/this.duration,this.frame(),this.tFrac>=1?(this.lastFrame(),!1):!0},t.prototype.firstFrame=function(){},t.prototype.frame=function(){},t.prototype.lastFrame=function(){},t}(),E.TransitionAnimator=function(t){function n(){this.update=T(this.update,this),n.__super__.constructor.apply(this,arguments),this.queue=[],this.transitions=[],this.onFrame(this.update)}return F(n,t),n.prototype.add=function(t){return this.transitions.push(t)},n.prototype.keyframe=function(){return this.queue.push(this.transitions),this.transitions=[]},n.prototype.update=function(t){var n;if(this.queue.length)return n=this.queue.shift(),n=n.filter(function(n){return n.update(t)}),n.length?this.queue.unshift(n):void 0},n}(E.Animator),w=[[0,2,1],[0,1,3],[3,2,0],[1,2,3]],e=[[0,1,3,2],[5,4,6,7],[1,0,4,5],[2,3,7,6],[3,1,5,7],[0,2,6,4]],v=[[1,0,2,3],[0,1,4],[2,0,4],[3,2,4],[1,3,4]],o=Math.sqrt(3)/2,f=.5257311121191336,d=.8506508083520399,p=[E.P(-f,0,-d),E.P(f,0,-d),E.P(-f,0,d),E.P(f,0,d),E.P(0,d,-f),E.P(0,d,f),E.P(0,-d,-f),E.P(0,-d,f),E.P(d,f,0),E.P(-d,f,0),E.P(d,-f,0),E.P(-d,-f,0)],c=[[0,4,1],[0,9,4],[9,5,4],[4,5,8],[4,8,1],[8,10,1],[8,3,10],[5,3,8],[5,2,3],[2,7,3],[7,10,3],[7,6,10],[7,11,6],[11,0,6],[0,1,6],[6,1,10],[9,0,11],[9,11,2],[9,2,5],[7,2,11]],E.Shapes={cube:function(){return function(){var t;return t=[E.P(-1,-1,-1),E.P(-1,-1,1),E.P(-1,1,-1),E.P(-1,1,1),E.P(1,-1,-1),E.P(1,-1,1),E.P(1,1,-1),E.P(1,1,1)],new E.Shape("cube",E.Shapes.mapPointsToSurfaces(t,e))}}(this),unitcube:function(){return function(){var t;return t=[E.P(0,0,0),E.P(0,0,1),E.P(0,1,0),E.P(0,1,1),E.P(1,0,0),E.P(1,0,1),E.P(1,1,0),E.P(1,1,1)],new E.Shape("unitcube",E.Shapes.mapPointsToSurfaces(t,e))}}(this),rectangle:function(){return function(t,n){var r,i;return r=function(e,r,i){return E.P(e(t.x,n.x),r(t.y,n.y),i(t.z,n.z))},i=[r(Math.min,Math.min,Math.min),r(Math.min,Math.min,Math.max),r(Math.min,Math.max,Math.min),r(Math.min,Math.max,Math.max),r(Math.max,Math.min,Math.min),r(Math.max,Math.min,Math.max),r(Math.max,Math.max,Math.min),r(Math.max,Math.max,Math.max)],new E.Shape("rect",E.Shapes.mapPointsToSurfaces(i,e))}}(this),pyramid:function(){return function(){var t;return t=[E.P(0,0,0),E.P(0,0,1),E.P(1,0,0),E.P(1,0,1),E.P(.5,1,.5)],new E.Shape("pyramid",E.Shapes.mapPointsToSurfaces(t,v))}}(this),tetrahedron:function(){return function(){var t;return t=[E.P(1,1,1),E.P(-1,-1,1),E.P(-1,1,-1),E.P(1,-1,-1)],new E.Shape("tetrahedron",E.Shapes.mapPointsToSurfaces(t,w))}}(this),icosahedron:function(){return new E.Shape("icosahedron",E.Shapes.mapPointsToSurfaces(p,c))},sphere:function(t){var n,e,r,i;for(null==t&&(t=2),i=c.map(function(t){return t.map(function(t){return p[t]})}),n=e=0,r=t;r>=0?r>e:e>r;n=r>=0?++e:--e)i=E.Shapes._subdivideTriangles(i);return new E.Shape("sphere",i.map(function(t){return new E.Surface(t.map(function(t){return t.copy()}))}))},pipe:function(t,n,e,r){var i,s,o,a,u,h;return null==e&&(e=1),null==r&&(r=8),i=n.copy().subtract(t),s=i.perpendicular().multiply(e),h=2*-Math.PI/r,a=E.Quaternion.pointAngle(i.copy().normalize(),h).toMatrix(),o=function(){u=[];for(var t=0;r>=0?r>t:t>r;r>=0?t++:t--)u.push(t);return u}.apply(this).map(function(){var n;return n=t.copy().add(s),s.transform(a),n}),E.Shapes.extrude(o,i)},patch:function(t,n){var e,r,i,s,a,u,h,l,c,p,f,d,m,y,g,v,x,_,w,M;for(null==t&&(t=20),null==n&&(n=20),t=Math.round(t),n=Math.round(n),x=[],w=l=0,m=t;m>=0?m>l:l>m;w=m>=0?++l:--l){for(s=[],M=_=0,y=n;y>=0?y>_:_>y;M=y>=0?++_:--_)for(f=[E.P(w,M),E.P(w+1,M-.5),E.P(w+1,M+.5)],d=[E.P(w,M),E.P(w+1,M+.5),E.P(w,M+1)],g=[f,d],e=0,a=g.length;a>e;e++){for(p=g[e],r=0,u=p.length;u>r;r++)c=p[r],c.x*=o,c.y+=w%2===0?.5:0;s.push(p)}if(w%2!==0){for(v=s[0],i=0,h=v.length;h>i;i++)c=v[i],c.y+=n;s.push(s.shift())}x=x.concat(s)}return new E.Shape("patch",x.map(function(t){return new E.Surface(t)}))},text:function(t,n){var e,r,i;null==n&&(n={}),r=new E.Surface(E.Affine.ORTHONORMAL_BASIS(),E.Painters.text),r.text=t;for(e in n)i=n[e],r[e]=i;return new E.Shape("text",[r])},extrude:function(t,n){var e,r,i,s,o,a,u,h;for(h=[],r=new E.Surface(function(){var n,e,r;for(r=[],e=0,n=t.length;n>e;e++)a=t[e],r.push(a.copy());return r}()),e=new E.Surface(function(){var e,r,i;for(i=[],r=0,e=t.length;e>r;r++)a=t[r],i.push(a.add(n));return i}()),i=o=1,u=t.length;u>=1?u>o:o>u;i=u>=1?++o:--o)h.push(new E.Surface([r.points[i-1].copy(),e.points[i-1].copy(),e.points[i].copy(),r.points[i].copy()]));return s=t.length,h.push(new E.Surface([r.points[s-1].copy(),e.points[s-1].copy(),e.points[0].copy(),r.points[0].copy()])),e.points.reverse(),h.push(r),h.push(e),new E.Shape("extrusion",h)},arrow:function(t,n,e,r,i){var s,o;return null==t&&(t=1),null==n&&(n=1),null==e&&(e=1),null==r&&(r=1),null==i&&(i=0),s=e/2,o=[E.P(0,0,0),E.P(r+i,1,0),E.P(r,s,0),E.P(r+n,s,0),E.P(r+n,-s,0),E.P(r,-s,0),E.P(r+i,-1,0)],E.Shapes.extrude(o,E.P(0,0,t))},path:function(t){return new E.Shape("path",[new E.Surface(t)])},custom:function(t){var n,e,r,i,s,o;for(o=[],s=t.surfaces,r=0,e=s.length;e>r;r++)n=s[r],o.push(new E.Surface(function(){var t,e,r;for(e=[],r=0,t=n.length;t>r;r++)i=n[r],e.push(E.P.apply(E,i));return e}()));return new E.Shape("custom",o)},mapPointsToSurfaces:function(t,n){var e,r,i,s,o,a;for(a=[],s=0,i=n.length;i>s;s++)r=n[s],o=function(){var n,i,s;for(i=[],s=0,n=r.length;n>s;s++)e=r[s],i.push(t[e].copy());return i}(),a.push(new E.Surface(o));return a},_subdivideTriangles:function(t){var n,e,r,i,s,o,a;for(e=[],r=0,n=t.length;n>r;r++)i=t[r],s=i[0].copy().add(i[1]).normalize(),o=i[1].copy().add(i[2]).normalize(),a=i[2].copy().add(i[0]).normalize(),e.push([i[0],s,a]),e.push([i[1],o,s]),e.push([i[2],a,o]),e.push([s,o,a]);return e}},E.MocapModel=function(){function t(t,n,e){this.model=t,this.frames=n,this.frameDelay=e}return t.prototype.applyFrameTransforms=function(t){var n,e,r,i;for(n=this.frames[t],r=0,e=n.length;e>r;r++)i=n[r],i.shape.reset().transform(i.transform);return(t+1)%this.frames.length},t}(),E.MocapAnimator=function(t){function n(t){this.mocap=t,this.renderFrame=T(this.renderFrame,this),n.__super__.constructor.apply(this,arguments),this.frameIndex=0,this.frameDelay=this.mocap.frameDelay,this.onFrame(this.renderFrame)}return F(n,t),n.prototype.renderFrame=function(){return this.frameIndex=this.mocap.applyFrameTransforms(this.frameIndex)},n}(E.Animator),E.Mocap=function(){function t(t){this.bvh=t}return t.DEFAULT_SHAPE_FACTORY=function(t,n){return E.Shapes.pipe(E.P(),n)},t.parse=function(t){return new E.Mocap(E.BvhParser.parse(t))},t.prototype.createMocapModel=function(t){var n,e,r;return null==t&&(t=E.Mocap.DEFAULT_SHAPE_FACTORY),r=new E.Model,e=[],this._attachJoint(r,this.bvh.root,e,t),n=this.bvh.motion.frames.map(function(t){return function(n){return t._generateFrameTransforms(n,e)}}(this)),new E.MocapModel(r,n,1e3*this.bvh.motion.frameTime)},t.prototype._generateFrameTransforms=function(t,n){var e,r;return e=0,r=n.map(function(n){return function(r){var i,s;for(s=E.M(),i=r.channels.length;i>0;)i-=1,n._applyChannelTransform(r.channels[i],s,t[e+i]);return e+=r.channels.length,s.multiply(r.offset),{shape:r.shape,transform:s}}}(this))},t.prototype._applyChannelTransform=function(t,n,e){switch(t){case"Xposition":n.translate(e,0,0);break;case"Yposition":n.translate(0,e,0);break;case"Zposition":n.translate(0,0,e);break;case"Xrotation":n.rotx(e*Math.PI/180);break;case"Yrotation":n.roty(e*Math.PI/180);break;case"Zrotation":n.rotz(e*Math.PI/180)}return n},t.prototype._attachJoint=function(t,n,e,r){var i,s,o,a,u,h,l,c,p,f,d,m,y;if(u=E.M().translate(null!=(l=n.offset)?l.x:void 0,null!=(c=n.offset)?c.y:void 0,null!=(p=n.offset)?p.z:void 0),t.transform(u),null!=n.channels&&e.push({shape:t,offset:u,channels:n.channels}),null!=n.joints)for(s=t.append(),f=n.joints,a=0,o=f.length;o>a;a++)i=f[a],h=E.P(null!=(d=i.offset)?d.x:void 0,null!=(m=i.offset)?m.y:void 0,null!=(y=i.offset)?y.z:void 0),s.add(r(n,h)),"JOINT"===i.type&&this._attachJoint(s.append(),i,e,r)},t}(),E.ObjParser=function(){function t(){this.vertices=[],this.faces=[],this.commands={v:function(t){return function(n){return t.vertices.push(n.map(function(t){return parseFloat(t)}))}}(this),f:function(t){return function(n){return t.faces.push(n.map(function(t){return parseInt(t)}))}}(this)}}return t.prototype.parse=function(t){var n,e,r,i,s,o,a;for(o=t.split(/[\r\n]+/),a=[],s=0,r=o.length;r>s;s++)i=o[s],e=i.trim().split(/[ ]+/),e.length<2||(n=e.slice(0,1)[0],e=e.slice(1),"#"!==n.charAt(0)&&(null!=this.commands[n]?a.push(this.commands[n](e)):console.log("OBJ Parser: Skipping unknown command '"+n+"'")));return a},t.prototype.mapFacePoints=function(t){return this.faces.map(function(n){return function(e){var r;return r=e.map(function(t){return E.P.apply(E,n.vertices[t-1])}),t.call(n,r)}}(this))},t}(),E.Shapes.obj=function(t,n){var e;return null==n&&(n=!0),e=new E.ObjParser,e.parse(t),new E.Shape("obj",e.mapFacePoints(function(t){var e;return e=new E.Surface(t),e.cullBackfaces=n,e}))},E.Projections={perspectiveFov:function(t,n){var e;return null==t&&(t=50),null==n&&(n=1),e=n*Math.tan(t*Math.PI/360),E.Projections.perspective(-e,e,-e,e,n,2*n)},perspective:function(t,n,e,r,i,s){var o,a,u,h,l;return null==t&&(t=-1),null==n&&(n=1),null==e&&(e=-1),null==r&&(r=1),null==i&&(i=1),null==s&&(s=100),l=2*i,o=n-t,a=r-e,u=s-i,h=new Array(16),h[0]=l/o,h[1]=0,h[2]=(n+t)/o,h[3]=0,h[4]=0,h[5]=l/a,h[6]=(r+e)/a,h[7]=0,h[8]=0,h[9]=0,h[10]=-(s+i)/u,h[11]=-(s*l)/u,h[12]=0,h[13]=0,h[14]=-1,h[15]=0,E.M(h)},ortho:function(t,n,e,r,i,s){var o,a,u,h,l;return null==t&&(t=-1),null==n&&(n=1),null==e&&(e=-1),null==r&&(r=1),null==i&&(i=1),null==s&&(s=100),l=2*i,o=n-t,a=r-e,u=s-i,h=new Array(16),h[0]=2/o,h[1]=0,h[2]=0,h[3]=(n+t)/o,h[4]=0,h[5]=2/a,h[6]=0,h[7]=-(r+e)/a,h[8]=0,h[9]=0,h[10]=-2/u,h[11]=-(s+i)/u,h[12]=0,h[13]=0,h[14]=0,h[15]=1,E.M(h)}},E.Viewports={center:function(t,n,e,r){var i,s;return null==t&&(t=500),null==n&&(n=500),null==e&&(e=0),null==r&&(r=0),s=E.M().translate(-e,-r,-n).scale(1/t,1/n,1/n),i=E.M().scale(t,-n,n).translate(e+t/2,r+n/2,n),{prescale:s,postscale:i}},origin:function(t,n,e,r){var i,s;return null==t&&(t=500),null==n&&(n=500),null==e&&(e=0),null==r&&(r=0),s=E.M().translate(-e,-r,-1).scale(1/t,1/n,1/n),i=E.M().scale(t,-n,n).translate(e,r),{prescale:s,postscale:i}}},E.Camera=function(t){function n(t){E.Util.defaults(this,t,this.defaults),n.__super__.constructor.apply(this,arguments)}return F(n,t),n.prototype.defaults={projection:E.Projections.perspective()},n}(E.Transformable),E.Scene=function(){function t(t){this.flushCache=T(this.flushCache,this),this.render=T(this.render,this),E.Util.defaults(this,t,this.defaults()),this._renderModelCache={}}return t.prototype.defaults=function(){return{model:new E.Model,camera:new E.Camera,viewport:E.Viewports.origin(1,1),shader:E.Shaders.phong(),cullBackfaces:!0,fractionalPoints:!1,cache:!0}},t.prototype.render=function(){var t,n,e;return t=this.camera.m.copy().multiply(this.viewport.prescale).multiply(this.camera.projection),e=this.viewport.postscale,n=[],this.model.eachRenderable(function(t,n){return new E.LightRenderModel(t,n)},function(r){return function(i,s,o){var a,u,h,l,c,p,f,d,m,y,g,v;for(c=i.surfaces,y=[],h=0,a=c.length;a>h;h++)if(g=c[h],m=r._renderSurface(g,o,t,e),(!r.cullBackfaces||!g.cullBackfaces||m.projected.normal.z<0)&&m.inFrustrum){if(m.fill=null!=(p=g.fillMaterial)?p.render(s,r.shader,m.transformed):void 0,m.stroke=null!=(f=g.strokeMaterial)?f.render(s,r.shader,m.transformed):void 0,r.fractionalPoints!==!0)for(d=m.projected.points,v=0,u=d.length;u>v;v++)l=d[v],l.round();y.push(n.push(m))}else y.push(void 0);return y}}(this)),n.sort(function(t,n){return n.projected.barycenter.z-t.projected.barycenter.z}),n},t.prototype._renderSurface=function(t,n,e,r){var i;return this.cache?(i=this._renderModelCache[t.id],null==i?i=this._renderModelCache[t.id]=new E.RenderModel(t,n,e,r):i.update(n,e,r),i):new E.RenderModel(t,n,e,r)},t.prototype.flushCache=function(){return this._renderModelCache={}},t}(),E.Grad=function(){function t(t,n,e){this.x=t,this.y=n,this.z=e}return t.prototype.dot=function(t,n,e){return this.x*t+this.y*n+this.z*e},t}(),S=[new E.Grad(1,1,0),new E.Grad(-1,1,0),new E.Grad(1,-1,0),new E.Grad(-1,-1,0),new E.Grad(1,0,1),new E.Grad(-1,0,1),new E.Grad(1,0,-1),new E.Grad(-1,0,-1),new E.Grad(0,1,1),new E.Grad(0,-1,1),new E.Grad(0,1,-1),new E.Grad(0,-1,-1)],_=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],u=1/3,l=1/6,E.Simplex3D=function(){function t(t){null==t&&(t=0),this.perm=new Array(512),this.gradP=new Array(512),this.seed(t)}return t.prototype.seed=function(t){var n,e,r,i;for(t>0&&1>t&&(t*=65536),t=Math.floor(t),256>t&&(t|=t<<8),r=[],n=e=0;256>e;n=++e)i=0,i=1&n?_[n]^255&t:_[n]^t>>8&255,this.perm[n]=this.perm[n+256]=i,r.push(this.gradP[n]=this.gradP[n+256]=S[i%12]);return r},t.prototype.noise=function(t,n,e){var r,i,s,o,a,h,c,p,f,d,m,y,g,v,x,_,w,M,P,S,b,C,A,z,E,T,q,F,R,I,D,L,U,k,O;return M=(t+n+e)*u,a=Math.floor(t+M),p=Math.floor(n+M),m=Math.floor(e+M),P=(a+p+m)*l,z=t-a+P,F=n-p+P,L=e-m+P,z>=F?F>=L?(h=1,f=0,y=0,c=1,d=1,g=0):z>=L?(h=1,f=0,y=0,c=1,d=0,g=1):(h=0,f=0,y=1,c=1,d=0,g=1):L>F?(h=0,f=0,y=1,c=0,d=1,g=1):L>z?(h=0,f=1,y=0,c=0,d=1,g=1):(h=0,f=1,y=0,c=1,d=1,g=0),E=z-h+l,R=F-f+l,U=L-y+l,T=z-c+2*l,I=F-d+2*l,k=L-g+2*l,q=z-1+3*l,D=F-1+3*l,O=L-1+3*l,a&=255,p&=255,m&=255,r=this.gradP[a+this.perm[p+this.perm[m]]],i=this.gradP[a+h+this.perm[p+f+this.perm[m+y]]],s=this.gradP[a+c+this.perm[p+d+this.perm[m+g]]],o=this.gradP[a+1+this.perm[p+1+this.perm[m+1]]],S=.5-z*z-F*F-L*L,0>S?v=0:(S*=S,v=S*S*r.dot(z,F,L)),b=.5-E*E-R*R-U*U,0>b?x=0:(b*=b,x=b*b*i.dot(E,R,U)),C=.5-T*T-I*I-k*k,0>C?_=0:(C*=C,_=C*C*s.dot(T,I,k)),A=.5-q*q-D*D-O*O,0>A?w=0:(A*=A,w=A*A*o.dot(q,D,O)),32*(v+x+_+w)},t}(),E.BvhParser=function(){"use strict";function t(t,n){function e(){this.constructor=t}e.prototype=n.prototype,t.prototype=new e}function n(t,e,r,i){this.message=t,this.expected=e,this.found=r,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}function e(t){function e(n){var e,r,i=In[n];if(i)return i;for(e=n-1;!In[e];)e--;for(i=In[e],i={line:i.line,column:i.column,seenCR:i.seenCR};n>e;)r=t.charAt(e),"\n"===r?(i.seenCR||i.line++,i.column=1,i.seenCR=!1):"\r"===r||"\u2028"===r||"\u2029"===r?(i.line++,i.column=1,i.seenCR=!0):(i.column++,i.seenCR=!1),e++;return In[n]=i,i}function r(t,n){var r=e(t),i=e(n);return{start:{offset:t,line:r.line,column:r.column},end:{offset:n,line:i.line,column:i.column}}}function i(t){Dn>Fn||(Fn>Dn&&(Dn=Fn,Ln=[]),Ln.push(t))}function s(t,e,r,i){function s(t){var n=1;for(t.sort(function(t,n){return t.description<n.description?-1:t.description>n.description?1:0});n<t.length;)t[n-1]===t[n]?t.splice(n,1):n++}function o(t,n){function e(t){function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+n(t)}).replace(/[\u0100-\u0FFF]/g,function(t){return"\\u0"+n(t)}).replace(/[\u1000-\uFFFF]/g,function(t){return"\\u"+n(t)})}var r,i,s,o=new Array(t.length);for(s=0;s<t.length;s++)o[s]=t[s].description;return r=t.length>1?o.slice(0,-1).join(", ")+" or "+o[t.length-1]:o[0],i=n?'"'+e(n)+'"':"end of input","Expected "+r+" but "+i+" found."}return null!==e&&s(e),new n(null!==t?t:o(e,r),e,r,i)}function o(){var n,e,r,s,o,u;return n=Fn,t.substr(Fn,9).toLowerCase()===S?(e=t.substr(Fn,9),Fn+=9):(e=w,0===Un&&i(b)),e!==w?(r=v(),r!==w?(s=a(),s!==w?(o=v(),o!==w?(u=p(),u!==w?(Rn=n,e=C(s,u),n=e):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w),n}function a(){var n,e,r,s,o,a,c,p,f,d,y,g,x;if(n=Fn,t.substr(Fn,4).toLowerCase()===A?(e=t.substr(Fn,4),Fn+=4):(e=w,0===Un&&i(z)),e!==w)if(r=v(),r!==w)if(s=m(),s!==w)if(o=v(),o!==w)if(123===t.charCodeAt(Fn)?(a=E,Fn++):(a=w,0===Un&&i(T)),a!==w)if(c=v(),c!==w)if(p=h(),p!==w)if(f=v(),f!==w)if(d=l(),d!==w)if(y=v(),y!==w){for(g=[],x=u();x!==w;)g.push(x),x=u();g!==w?(125===t.charCodeAt(Fn)?(x=q,Fn++):(x=w,0===Un&&i(F)),x!==w?(Rn=n,e=R(s,p,d,g),n=e):(Fn=n,n=w)):(Fn=n,n=w)}else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;return n}function u(){var n,e,r,s,o,a,c,p,f,d,y,g,x,_;if(n=Fn,t.substr(Fn,5).toLowerCase()===I?(e=t.substr(Fn,5),Fn+=5):(e=w,0===Un&&i(D)),e!==w)if(r=v(),r!==w)if(s=m(),s!==w)if(o=v(),o!==w)if(123===t.charCodeAt(Fn)?(a=E,Fn++):(a=w,0===Un&&i(T)),a!==w)if(c=v(),c!==w)if(p=h(),p!==w)if(f=v(),f!==w)if(d=l(),d!==w)if(y=v(),y!==w){for(g=[],x=u();x!==w;)g.push(x),x=u();g!==w?(125===t.charCodeAt(Fn)?(x=q,Fn++):(x=w,0===Un&&i(F)),x!==w?(_=v(),_!==w?(Rn=n,e=L(s,p,d,g),n=e):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)}else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;return n===w&&(n=Fn,t.substr(Fn,8).toLowerCase()===U?(e=t.substr(Fn,8),Fn+=8):(e=w,0===Un&&i(k)),e!==w?(r=v(),r!==w?(123===t.charCodeAt(Fn)?(s=E,Fn++):(s=w,0===Un&&i(T)),s!==w?(o=v(),o!==w?(a=h(),a!==w?(c=v(),c!==w?(125===t.charCodeAt(Fn)?(p=q,Fn++):(p=w,0===Un&&i(F)),p!==w?(f=v(),f!==w?(Rn=n,e=O(a),n=e):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)),n}function h(){var n,e,r,s,o,a,u,h;return n=Fn,t.substr(Fn,6).toLowerCase()===j?(e=t.substr(Fn,6),Fn+=6):(e=w,0===Un&&i(Z)),e!==w?(r=v(),r!==w?(s=y(),s!==w?(o=v(),o!==w?(a=y(),a!==w?(u=v(),u!==w?(h=y(),h!==w?(Rn=n,e=X(s,a,h),n=e):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w)):(Fn=n,n=w),n}function l(){var n,e,r,s,o,a,u;if(n=Fn,t.substr(Fn,8).toLowerCase()===N?(e=t.substr(Fn,8),Fn+=8):(e=w,0===Un&&i(Y)),e!==w)if(r=v(),r!==w)if(W.test(t.charAt(Fn))?(s=t.charAt(Fn),Fn++):(s=w,0===Un&&i(B)),s!==w)if(o=v(),o!==w){for(a=[],u=c();u!==w;)a.push(u),u=c();a!==w?(Rn=n,e=G(s,a),n=e):(Fn=n,n=w)}else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;return n}function c(){var n,e,r;return n=Fn,t.substr(Fn,9).toLowerCase()===H?(e=t.substr(Fn,9),Fn+=9):(e=w,0===Un&&i(Q)),e===w&&(t.substr(Fn,9).toLowerCase()===J?(e=t.substr(Fn,9),Fn+=9):(e=w,0===Un&&i(V)),e===w&&(t.substr(Fn,9).toLowerCase()===K?(e=t.substr(Fn,9),Fn+=9):(e=w,0===Un&&i($)),e===w&&(t.substr(Fn,9).toLowerCase()===tn?(e=t.substr(Fn,9),Fn+=9):(e=w,0===Un&&i(nn)),e===w&&(t.substr(Fn,9).toLowerCase()===en?(e=t.substr(Fn,9),Fn+=9):(e=w,0===Un&&i(rn)),e===w&&(t.substr(Fn,9).toLowerCase()===sn?(e=t.substr(Fn,9),Fn+=9):(e=w,0===Un&&i(on))))))),e!==w?(r=v(),r!==w?(Rn=n,e=an(e),n=e):(Fn=n,n=w)):(Fn=n,n=w),n}function p(){var n,e,r,s,o,a,u,h,l,c,p,d,m;if(n=Fn,t.substr(Fn,6).toLowerCase()===un?(e=t.substr(Fn,6),Fn+=6):(e=w,0===Un&&i(hn)),e!==w)if(r=v(),r!==w)if(t.substr(Fn,7).toLowerCase()===ln?(s=t.substr(Fn,7),Fn+=7):(s=w,0===Un&&i(cn)),s!==w)if(o=v(),o!==w)if(a=g(),a!==w)if(u=v(),u!==w)if(t.substr(Fn,11).toLowerCase()===pn?(h=t.substr(Fn,11),Fn+=11):(h=w,0===Un&&i(fn)),h!==w)if(l=v(),l!==w)if(c=y(),c!==w)if(p=v(),p!==w){for(d=[],m=f();m!==w;)d.push(m),m=f();d!==w?(Rn=n,e=dn(a,c,d),n=e):(Fn=n,n=w)}else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;else Fn=n,n=w;return n}function f(){var n,e,r,s;if(n=Fn,e=[],r=d(),r!==w)for(;r!==w;)e.push(r),r=d();else e=w;if(e!==w){if(r=[],mn.test(t.charAt(Fn))?(s=t.charAt(Fn),Fn++):(s=w,0===Un&&i(yn)),s!==w)for(;s!==w;)r.push(s),mn.test(t.charAt(Fn))?(s=t.charAt(Fn),Fn++):(s=w,0===Un&&i(yn));else r=w;r!==w?(Rn=n,e=gn(e),n=e):(Fn=n,n=w)}else Fn=n,n=w;return n}function d(){var n,e,r,s;if(n=Fn,e=y(),e!==w){for(r=[],vn.test(t.charAt(Fn))?(s=t.charAt(Fn),Fn++):(s=w,0===Un&&i(xn));s!==w;)r.push(s),vn.test(t.charAt(Fn))?(s=t.charAt(Fn),Fn++):(s=w,0===Un&&i(xn));r!==w?(Rn=n,e=_n(e),n=e):(Fn=n,n=w)}else Fn=n,n=w;return n}function m(){var n,e,r;if(n=Fn,e=[],wn.test(t.charAt(Fn))?(r=t.charAt(Fn),Fn++):(r=w,0===Un&&i(Mn)),r!==w)for(;r!==w;)e.push(r),wn.test(t.charAt(Fn))?(r=t.charAt(Fn),Fn++):(r=w,0===Un&&i(Mn));else e=w;return n=e!==w?t.substring(n,Fn):e}function y(){var n,e,r;if(n=Fn,e=[],Pn.test(t.charAt(Fn))?(r=t.charAt(Fn),Fn++):(r=w,0===Un&&i(Sn)),r!==w)for(;r!==w;)e.push(r),Pn.test(t.charAt(Fn))?(r=t.charAt(Fn),Fn++):(r=w,0===Un&&i(Sn));else e=w;return e!==w&&(Rn=n,e=bn(e)),n=e}function g(){var n,e,r;if(n=Fn,e=[],Cn.test(t.charAt(Fn))?(r=t.charAt(Fn),Fn++):(r=w,0===Un&&i(An)),r!==w)for(;r!==w;)e.push(r),Cn.test(t.charAt(Fn))?(r=t.charAt(Fn),Fn++):(r=w,0===Un&&i(An));else e=w;return e!==w&&(Rn=n,e=zn(e)),n=e}function v(){var n,e,r;for(n=Fn,e=[],En.test(t.charAt(Fn))?(r=t.charAt(Fn),Fn++):(r=w,0===Un&&i(Tn));r!==w;)e.push(r),En.test(t.charAt(Fn))?(r=t.charAt(Fn),Fn++):(r=w,0===Un&&i(Tn));return e!==w&&(Rn=n,e=qn()),n=e}var x,_=arguments.length>1?arguments[1]:{},w={},M={program:o},P=o,S="hierarchy",b={type:"literal",value:"HIERARCHY",description:'"HIERARCHY"'},C=function(t,n){return{root:t,motion:n}},A="root",z={type:"literal",value:"ROOT",description:'"ROOT"'},E="{",T={type:"literal",value:"{",description:'"{"'},q="}",F={type:"literal",value:"}",description:'"}"'},R=function(t,n,e,r){return{id:t,offset:n,channels:e,joints:r}},I="joint",D={type:"literal",value:"JOINT",description:'"JOINT"'},L=function(t,n,e,r){return{type:"JOINT",id:t,offset:n,channels:e,joints:r}},U="end site",k={type:"literal",value:"END SITE",description:'"END SITE"'},O=function(t){return{type:"END SITE",offset:t}},j="offset",Z={type:"literal",value:"OFFSET",description:'"OFFSET"'},X=function(t,n,e){return{x:t,y:n,z:e}},N="channels",Y={type:"literal",value:"CHANNELS",description:'"CHANNELS"'},W=/^[0-9]/,B={type:"class",value:"[0-9]",description:"[0-9]"},G=function(t,n){return n},H="xposition",Q={type:"literal",value:"Xposition",description:'"Xposition"'},J="yposition",V={type:"literal",value:"Yposition",description:'"Yposition"'},K="zposition",$={type:"literal",value:"Zposition",description:'"Zposition"'},tn="xrotation",nn={type:"literal",value:"Xrotation",description:'"Xrotation"'},en="yrotation",rn={type:"literal",value:"Yrotation",description:'"Yrotation"'},sn="zrotation",on={type:"literal",value:"Zrotation",description:'"Zrotation"'},an=function(t){return t},un="motion",hn={type:"literal",value:"MOTION",description:'"MOTION"'},ln="frames:",cn={type:"literal",value:"Frames:",description:'"Frames:"'},pn="frame time:",fn={type:"literal",value:"Frame Time:",description:'"Frame Time:"'},dn=function(t,n,e){return{frameCount:t,frameTime:n,frames:e}},mn=/^[\n\r]/,yn={type:"class",value:"[\\n\\r]",description:"[\\n\\r]"},gn=function(t){return t},vn=/^[ ]/,xn={type:"class",value:"[ ]",description:"[ ]"},_n=function(t){return t},wn=/^[a-zA-Z0-9\-_]/,Mn={type:"class",value:"[a-zA-Z0-9-_]",description:"[a-zA-Z0-9-_]"},Pn=/^[\-0-9.e]/,Sn={type:"class",value:"[-0-9.e]",description:"[-0-9.e]"},bn=function(t){return parseFloat(t.join(""))},Cn=/^[\-0-9e]/,An={type:"class",value:"[-0-9e]",description:"[-0-9e]"},zn=function(t){return parseInt(t.join(""))},En=/^[ \t\n\r]/,Tn={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},qn=function(){return void 0},Fn=0,Rn=0,In=[{line:1,column:1,seenCR:!1}],Dn=0,Ln=[],Un=0;if("startRule"in _){if(!(_.startRule in M))throw new Error("Can't start parsing from rule \""+_.startRule+'".');P=M[_.startRule]}if(x=P(),x!==w&&Fn===t.length)return x;throw x!==w&&Fn<t.length&&i({type:"end",description:"end of input"}),s(null,Ln,Dn<t.length?t.charAt(Dn):null,Dn<t.length?r(Dn,Dn+1):r(Dn,Dn))}return t(n,Error),{SyntaxError:n,parse:e}}()}(this);